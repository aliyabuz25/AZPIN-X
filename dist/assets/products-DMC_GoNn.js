import"./modulepreload-polyfill-B5Qt9EMX.js";import{s as u}from"./supabase-eU6qekuo.js";import{i as ae,C as se,g as oe}from"./cart-CrrfKN6I.js";import{i as ie}from"./snow-faULLne8.js";const re={API_URL:"/api"};let j=[],p=1,_="all";const S=()=>({themeBtn:document.getElementById("thm-btn"),out:document.getElementById("out"),loader:document.getElementById("loader"),pagination:document.getElementById("pagination"),find:document.getElementById("side-search"),topSearch:document.getElementById("top-search"),filterBtn:document.getElementById("filter-btn"),sortOptions:document.getElementsByName("sort"),brandList:document.getElementById("brand-list")});async function ce(){const n=S();try{j=(await(await fetch(`${re.API_URL}/products`)).json()).data?.products||[],n.loader&&(n.loader.style.display="none"),R(),T(1)}catch{n.loader&&(n.loader.innerText="Xəta: Məhsullar yüklənə bilmədi.")}}function T(n=1){const s=S();if(!s.out)return;p=n;const c=s.find?.value?.toLowerCase()||s.topSearch?.value?.toLowerCase()||"",a=20;let r=[...j].filter(o=>{const g=o.name.toLowerCase().includes(c),l=_==="all"||o.category_name===_;return g&&l});r.sort((o,g)=>{const l=o.in_stock===!0||parseInt(o.stock)>0,L=g.in_stock===!0||parseInt(g.stock)>0;if(l&&!L)return-1;if(!l&&L)return 1;const i=[...s.sortOptions].find(v=>v.checked)?.value;return i==="az"?o.name.localeCompare(g.name):i==="high"?parseFloat(g.price)-parseFloat(o.price):i==="low"?parseFloat(o.price)-parseFloat(g.price):0});const h=r.length,m=Math.ceil(h/a),f=r.slice((p-1)*a,p*a);s.out.innerHTML="",f.forEach((o,g)=>{const l=o.in_stock===!0||parseInt(o.stock)>0,L=parseFloat(o.price).toLocaleString("az-AZ",{minimumFractionDigits:2}),i=(parseFloat(o.price)*1.05).toLocaleString("az-AZ",{minimumFractionDigits:2}),v=Math.floor(Math.random()*5)+3,I="https://dummyimage.com/400x500/f1f5f9/94a3b8.png?text=AZPIN-X",x=document.createElement("div");x.className="product-card rounded-2xl p-4 flex flex-col group relative overflow-hidden opacity-0 shadow-sm border border-border bg-surface";const k=l?"":`
            <div class="absolute inset-0 bg-white/60  backdrop-blur-[2px] z-10 flex items-center justify-center p-6 text-center">
                <div class="bg-zinc-900 text-white text-[10px] font-black px-4 py-2 rounded-full shadow-2xl uppercase tracking-widest">Stokda Bitib</div>
            </div>
        `;x.innerHTML=`
            ${k}
            <div class="aspect-[4/5] rounded-xl bg-white flex items-center justify-center relative overflow-hidden mb-5">
                <img src="${o.image||I}" 
                     class="w-full h-full object-contain transition-transform duration-500"
                     alt="${o.name}" loading="lazy" onerror="this.src='${I}'">
                <div class="absolute bottom-3 right-3 bg-accent text-white text-[10px] font-black px-2 py-1 rounded shadow-lg shadow-accent/20 z-20">
                    -${v}%
                </div>
            </div>
            <div class="flex-1 flex flex-col px-1">
                <h3 class="text-sm font-black text-black  line-clamp-2 h-10 mb-4 text-center leading-snug uppercase notranslate">
                    ${o.name}
                </h3>
                <div class="mt-auto flex items-center justify-between">
                    <div class="flex flex-col">
                        <span class="text-[10px] text-zinc-400 line-through font-bold leading-none mb-1">${i} ₼</span>
                        <div class="text-base font-black text-zinc-950  leading-none">${L} <span class="text-[10px]">₼</span></div>
                    </div>
                    <button onclick="addToCart('${o.id}')" class="w-10 h-10 rounded-full keep-round bg-accent text-white transition-all flex items-center justify-center shadow-lg shadow-accent/20 hover:brightness-110 active:scale-95 group/btn">
                        <i class="ri-add-line text-lg add-to-cart-icon group-active/btn:scale-90 transition-transform"></i>
                    </button>
                </div>
            </div>
        `,s.out.appendChild(x),oe.to(x,{opacity:1,y:0,duration:.4,delay:g*.02})}),le(m)}function le(n){const s=S();if(!s.pagination||(s.pagination.innerHTML="",n<=1))return;const c=(a,r,h=!1,m=!1)=>{const f=document.createElement("button");return f.className=`min-w-[44px] h-11 px-3 rounded-xl border flex items-center justify-center font-black text-[11px] transition-all 
            ${h?"bg-accent text-white border-accent shadow-lg shadow-accent/20":"bg-surface border-border hover:border-accent hover:text-accent"} 
            ${m?"opacity-30 cursor-not-allowed":"cursor-pointer"}`,f.innerHTML=a,m||(f.onclick=()=>{window.scrollTo({top:0,behavior:"smooth"}),T(r)}),f};s.pagination.appendChild(c('<i class="ri-arrow-left-s-line text-lg"></i>',p-1,!1,p===1));for(let a=1;a<=n;a++)if(a===1||a===n||a>=p-2&&a<=p+2)s.pagination.appendChild(c(a,a,a===p));else if(a===p-3||a===p+3){const r=document.createElement("span");r.innerText="...",r.className="px-1 font-bold opacity-30",s.pagination.appendChild(r)}s.pagination.appendChild(c('<i class="ri-arrow-right-s-line text-lg"></i>',p+1,!1,p===n))}function R(){const n=S();if(!n.brandList)return;const s=[...new Set(j.map(a=>a.category_name))].filter(Boolean).sort();n.brandList.innerHTML="";const c=(a,r,h)=>{const m=document.createElement("label");return m.className=`flex items-center gap-3 p-2.5 rounded-xl hover:bg-zinc-50  cursor-pointer group transition-all ${h?"bg-accent/5 border border-accent/20":"border border-transparent"}`,m.innerHTML=`
            <input type="radio" name="brand" value="${r}" class="w-4 h-4 accent-accent" ${h?"checked":""}>
            <span class="text-[12px] font-bold notranslate ${h?"text-accent":"text-zinc-600  group-hover:text-text"} transition-colors">${a}</span>
        `,m.onclick=f=>{_=r,R(),T(1)},m};n.brandList.appendChild(c("Bütün Markalar","all",_==="all")),s.forEach(a=>{n.brandList.appendChild(c(a,a,_===a))})}function de(){const n=S();n.filterBtn?.addEventListener("click",()=>T(1)),[n.find,n.topSearch].forEach(r=>{r?.addEventListener("input",()=>T(1))});const c=r=>{document.documentElement.classList.toggle("dark",r==="dark"),localStorage.setItem("theme",r)},a=localStorage.getItem("theme")||"light";c(a),n.themeBtn?.addEventListener("click",()=>{const r=document.documentElement.classList.contains("dark")?"light":"dark";c(r)}),ue(),ce()}ae();ie();document.addEventListener("DOMContentLoaded",de);window.addToCart=n=>{const s=j.find(c=>c.id==n);s&&se.add({id:s.id,name:s.name,price:s.price,image:s.image})};function ue(){const n=document.getElementById("auth-modal"),s=document.getElementById("auth-close"),c=document.getElementById("login-btn"),a=document.getElementById("register-btn"),r=document.getElementById("logout-btn"),h=document.getElementById("user-menu"),m=document.getElementById("user-name"),f=document.getElementById("user-menu-btn"),o=document.getElementById("user-menu-dropdown"),g=document.getElementById("profile-btn"),l=document.getElementById("profile-modal"),L=document.getElementById("profile-close"),i=document.getElementById("profile-message"),v=document.getElementById("profile-avatar"),I=document.getElementById("profile-avatar-input"),x=document.getElementById("profile-first-name"),k=document.getElementById("profile-last-name"),G=document.getElementById("profile-email"),V=document.getElementById("profile-password"),M=document.getElementById("profile-phone"),q=document.getElementById("profile-country"),Q=document.getElementById("profile-otp-code"),Z=document.getElementById("profile-save"),J=document.getElementById("profile-email-btn"),W=document.getElementById("profile-password-btn"),E=document.getElementById("profile-otp-send"),X=document.getElementById("profile-otp-verify"),Y="/api/upload",K="/api/otp/send",ee="/api/otp/verify";let P="";const w=document.getElementById("tab-login"),B=document.getElementById("tab-register"),U=document.getElementById("login-form"),$=document.getElementById("register-form"),y=document.getElementById("auth-message"),D=e=>{n&&(n.classList.remove("hidden"),n.classList.add("flex"),F(e))},O=()=>{n&&(n.classList.add("hidden"),n.classList.remove("flex"),y&&(y.textContent=""))},F=e=>{const t=e==="login";U&&U.classList.toggle("hidden",!t),$&&$.classList.toggle("hidden",t),w?.classList.toggle("border-accent",t),w?.classList.toggle("text-accent",t),w?.classList.toggle("bg-accent/5",t),B?.classList.toggle("border-accent",!t),B?.classList.toggle("text-accent",!t),B?.classList.toggle("bg-accent/5",!t),w?.classList.toggle("border-border",!t),w?.classList.toggle("text-text-muted",!t),B?.classList.toggle("border-border",t),B?.classList.toggle("text-text-muted",t)};c?.addEventListener("click",e=>{e.preventDefault(),D("login")}),a?.addEventListener("click",e=>{e.preventDefault(),D("register")}),s?.addEventListener("click",O),n?.addEventListener("click",e=>{e.target===n&&O()}),w?.addEventListener("click",()=>F("login")),B?.addEventListener("click",()=>F("register")),U?.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("login-email")?.value||"",b=document.getElementById("login-password")?.value||"",{error:d}=await u.auth.signInWithPassword({email:t,password:b});if(d){y&&(y.textContent=d.message);return}y&&(y.textContent="Uğurla daxil oldunuz."),O()}),$?.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("register-email")?.value||"",b=document.getElementById("register-password")?.value||"",d=$.querySelector('button[type="submit"]'),C=d?.innerHTML;d&&(d.disabled=!0,d.innerHTML=`
                <span class="inline-flex items-center gap-2">
                    <i class="ri-loader-4-line animate-spin"></i>
                    Göndərilir...
                </span>
            `);const{data:N,error:z}=await u.auth.signUp({email:t,password:b,options:{emailRedirectTo:`${window.location.origin}/confirm.html`}});if(d&&(d.disabled=!1,C&&(d.innerHTML=C)),z){y&&(y.textContent=z.status===500?"Qeydiyyat hazırda bağlıdır. Supabase Auth ayarlarını yoxlayın.":z.message);return}const ne=!N?.session;if(N?.user&&await u.from("profiles").upsert({user_id:N.user.id,first_name:"",last_name:"",phone:"",avatar_url:""},{onConflict:"user_id"}),ne){window.location.href="/auth-wait.html";return}y&&(y.textContent="Qeydiyyat tamamlandı."),O()}),r?.addEventListener("click",async e=>{e.preventDefault(),await u.auth.signOut()});const te=async()=>{const{data:e}=await u.auth.getUser();if(!e?.user){D("login");return}if(!l)return;l.classList.remove("hidden"),l.classList.add("flex"),i&&(i.textContent="");const t=e.user.user_metadata||{};v&&(v.src=t.avatar_url||v.src),x&&(x.value=t.first_name||""),k&&(k.value=t.last_name||""),M&&(M.value=t.phone||""),P=t.avatar_url||""};g?.addEventListener("click",e=>{e.preventDefault(),te()}),L?.addEventListener("click",()=>{l&&(l.classList.add("hidden"),l.classList.remove("flex"))}),l?.addEventListener("click",e=>{e.target===l&&(l.classList.add("hidden"),l.classList.remove("flex"))}),I?.addEventListener("change",async()=>{const e=I.files?.[0];if(!e)return;const t=new FormData;t.append("avatar",e);const d=await(await fetch(Y,{method:"POST",body:t})).json();d?.url&&(P=d.url,v&&(v.src=P))}),Z?.addEventListener("click",async()=>{const{data:e}=await u.auth.getUser();if(!e?.user)return;const t={first_name:x?.value||"",last_name:k?.value||"",phone:M?.value||"",avatar_url:P||""},{error:b}=await u.auth.updateUser({data:{...t,full_name:`${t.first_name} ${t.last_name}`.trim()}});if(b){i&&(i.textContent=b.message);return}await u.from("profiles").upsert({user_id:e.user.id,...t},{onConflict:"user_id"}),i&&(i.textContent="Profil yeniləndi."),m&&(m.textContent=t.first_name||e.user.email||"Hesab")}),J?.addEventListener("click",async()=>{const e=G?.value||"";if(!e)return;const{error:t}=await u.auth.updateUser({email:e});i&&(i.textContent=t?t.message:"E-mail yeniləmə linki göndərildi.")}),W?.addEventListener("click",async()=>{const e=V?.value||"";if(!e)return;const{error:t}=await u.auth.updateUser({password:e});i&&(i.textContent=t?t.message:"Şifrə yeniləndi.")});const H=()=>{const e=q?.value||"",t=M?.value||"";return`${e}${t}`.replace(/\s+/g,"")};E?.addEventListener("click",async()=>{const e=H();if(!e)return;const t=E.textContent;E.classList.add("is-loading"),E.innerHTML='<span class="inline-flex items-center gap-2"><i class="ri-loader-4-line animate-spin"></i> Göndərilir...</span>';const d=await(await fetch(K,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:e})})).json();E.classList.remove("is-loading"),E.textContent=t||"OTP Göndər",i&&(i.textContent=d?.ok?"OTP göndərildi.":"OTP göndərilmədi.")}),X?.addEventListener("click",async()=>{const e=H(),t=Q?.value||"";if(!e||!t)return;if((await(await fetch(ee,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:e,code:t})})).json())?.ok){await u.auth.updateUser({data:{phone:e,phone_verified:!0}});const{data:C}=await u.auth.getUser();C?.user&&await u.from("profiles").upsert({user_id:C.user.id,phone:e,phone_verified:!0},{onConflict:"user_id"}),i&&(i.textContent="Telefon təsdiqləndi.")}else i&&(i.textContent="OTP yanlışdır.")}),f?.addEventListener("click",e=>{e.preventDefault(),o?.classList.toggle("hidden")}),document.addEventListener("click",e=>{if(!o||!f)return;const t=e.target;f.contains(t)||o.contains(t)||o.classList.add("hidden")});const A=async e=>{if(e){if(c?.classList.add("hidden"),a?.classList.add("hidden"),h?.classList.remove("hidden"),o?.classList.add("hidden"),m){const t=e.user_metadata?.full_name;m.textContent=t||e.email||"Hesab"}}else c?.classList.remove("hidden"),a?.classList.remove("hidden"),h?.classList.add("hidden")};u.auth.getUser().then(({data:e})=>A(e.user)),u.auth.onAuthStateChange((e,t)=>{A(t?.user||null)})}
